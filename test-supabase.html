<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase è¿æ¥æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background: #1a1a1a;
      color: #fff;
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      color: #d4af37;
    }
    .status {
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      font-size: 18px;
    }
    .success {
      background: #10b981;
      border: 2px solid #059669;
    }
    .error {
      background: #ef4444;
      border: 2px solid #dc2626;
    }
    .loading {
      background: #f59e0b;
      border: 2px solid #d97706;
    }
    pre {
      background: #2a2a2a;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ Supabase è¿æ¥æµ‹è¯•</h1>
  <div id="status" class="status loading">â³ æ­£åœ¨æµ‹è¯•è¿æ¥...</div>
  <div id="details"></div>

  <script type="module">
    const statusDiv = document.getElementById('status');
    const detailsDiv = document.getElementById('details');

    async function testConnection() {
      try {
        console.log('å¼€å§‹æµ‹è¯•...');

        // æµ‹è¯• 1: å¯¼å…¥æ¨¡å—
        statusDiv.textContent = 'â³ æ­£åœ¨å¯¼å…¥ Supabase æ¨¡å—...';
        const { supabase } = await import('./js/supabase-client.js');
        console.log('âœ“ æ¨¡å—å¯¼å…¥æˆåŠŸ');

        // æµ‹è¯• 2: æ£€æŸ¥å®¢æˆ·ç«¯
        statusDiv.textContent = 'â³ æ­£åœ¨æ£€æŸ¥ Supabase å®¢æˆ·ç«¯...';
        if (!supabase) {
          throw new Error('Supabase å®¢æˆ·ç«¯æœªåˆå§‹åŒ–');
        }
        console.log('âœ“ å®¢æˆ·ç«¯å·²åˆå§‹åŒ–');

        // æµ‹è¯• 3: æŸ¥è¯¢æ•°æ®åº“
        statusDiv.textContent = 'â³ æ­£åœ¨æŸ¥è¯¢æ•°æ®åº“...';
        const { data, error } = await supabase
          .from('guitar_repairs')
          .select('id')
          .limit(1);

        if (error) {
          throw error;
        }

        console.log('âœ“ æ•°æ®åº“æŸ¥è¯¢æˆåŠŸ');

        // æˆåŠŸ
        statusDiv.className = 'status success';
        statusDiv.textContent = 'âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Supabase è¿æ¥æ­£å¸¸ã€‚';

        detailsDiv.innerHTML = `
          <h2>æµ‹è¯•ç»“æœ</h2>
          <pre>âœ“ æ¨¡å—å¯¼å…¥æˆåŠŸ
âœ“ å®¢æˆ·ç«¯å·²åˆå§‹åŒ–
âœ“ æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ“ æŸ¥è¯¢è¿”å› ${data ? data.length : 0} æ¡è®°å½•</pre>
          <p style="color: #10b981; font-weight: bold;">
            ğŸ‰ ä¿®å¤æˆåŠŸï¼ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰æŒ‰é’®åŠŸèƒ½äº†ã€‚
          </p>
          <p>
            <a href="index.html" style="color: #d4af37; font-size: 18px;">â† è¿”å›ä¸»é¡µæµ‹è¯•æŒ‰é’®</a>
          </p>
        `;

      } catch (error) {
        console.error('æµ‹è¯•å¤±è´¥:', error);

        statusDiv.className = 'status error';
        statusDiv.textContent = 'âŒ æµ‹è¯•å¤±è´¥';

        detailsDiv.innerHTML = `
          <h2>é”™è¯¯è¯¦æƒ…</h2>
          <pre>${error.message}</pre>
          <pre>${error.stack || ''}</pre>
          <p style="color: #ef4444;">
            å¦‚æœçœ‹åˆ°æ­¤é”™è¯¯ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå¹¶æä¾›ä¸Šè¿°é”™è¯¯ä¿¡æ¯ã€‚
          </p>
        `;
      }
    }

    testConnection();
  </script>
</body>
</html>
