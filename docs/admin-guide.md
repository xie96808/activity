# 管理员后台设置指南

本指南将帮助您设置和使用吉他维修预约系统的管理员后台。

## 1. 创建管理员账号

管理员后台使用 Supabase Auth 进行身份验证。您需要在 Supabase Dashboard 中手动创建管理员账号。

### 步骤：

1. 登录 [Supabase Dashboard](https://app.supabase.com)
2. 选择您的项目
3. 点击左侧菜单的 **Authentication** > **Users**
4. 点击 **Add user** 按钮
5. 填写管理员信息：
   - **Email**: 输入 `用户名@localhost.com` 格式（例如：`admin@localhost.com`）
   - **Password**: 设置一个强密码
   - **Auto Confirm User**: ✅ 勾选（跳过邮箱验证）
6. 点击 **Create user**

**重要说明**：
- 登录时只需输入用户名部分（如 `admin`），系统会自动转换为 `admin@localhost.com` 进行认证
- 例如：在 Supabase 中创建 `admin@localhost.com`，登录时输入用户名 `admin` 即可
- 请妥善保管管理员账号信息，不要泄露给他人

**示例**：
- Supabase 中创建：`admin@localhost.com` + 密码
- 登录时输入：用户名 `admin` + 密码

## 2. 访问管理员后台

### 登录页面

访问 `admin.html` 进入管理员登录页面：

```
https://your-domain.com/admin.html
```

输入您的用户名和密码，点击"登录"。

**登录说明**：
- 用户名：输入您在 Supabase 中创建的用户名部分（例如：`admin`）
- 密码：输入您设置的密码
- 系统会自动将用户名转换为 `username@local` 格式进行认证

**示例**：
- 如果在 Supabase 中创建了 `admin@local`
- 登录时只需输入用户名 `admin` 和密码即可

### 管理后台主页

登录成功后，您将进入管理后台主页 (`admin-dashboard.html`)，包含三个主要功能模块：

1. **维修单管理** - 查看和管理所有维修订单
2. **日历视图** - 查看未来一月的预约情况
3. **快捷操作** - 批量操作和数据导出

## 3. 维修单管理

### 功能概览

- **筛选订单**：按状态、日期、电话号码筛选
- **查看详情**：点击"查看详情"按钮查看订单完整信息
- **更改状态**：点击"更改状态"按钮修改订单状态
- **删除订单**：仅已取消的订单可以删除

### 订单状态说明

| 状态 | 说明 | 操作建议 |
|------|------|----------|
| 待确认 (pending) | 客户刚提交的订单 | 联系客户确认预约信息 |
| 已确认 (confirmed) | 已与客户确认预约 | 等待预约日期到来 |
| 维修中 (in_progress) | 正在维修中 | 完成后更改为"已完成" |
| 已完成 (completed) | 维修已完成 | 归档订单 |
| 已取消 (cancelled) | 订单已取消 | 可以删除 |

### 统计卡片

页面顶部显示四个统计卡片：

- **待确认**：状态为"待确认"的订单数量
- **进行中**：状态为"已确认"或"维修中"的订单数量
- **已完成**：状态为"已完成"的订单数量
- **总订单**：所有订单的总数量

### 查看订单详情

点击"查看详情"按钮，弹窗将显示：

- 订单基本信息（ID、状态、创建时间、更新时间）
- 客户信息（电话）
- 吉他信息（类型、品牌、型号、问题描述、图片/视频）
- 预约信息（预约日期、时间段、期望完成日期）
- 管理员备注（如有）

### 更改订单状态

1. 点击"更改状态"按钮
2. 在弹出的对话框中输入新状态（pending/confirmed/in_progress/completed/cancelled）
3. 可选：输入管理员备注
4. 确认后状态将立即更新

## 4. 日历视图

### 功能说明

日历视图显示未来一月的预约情况，帮助您快速了解每天的工作负荷。

### 日期颜色标识

- **绿色（空闲）**：当天预约数 ≤ 3 单
- **黄色（一般）**：当天预约数 4-6 单
- **红色（繁忙）**：当天预约数 > 6 单
- **灰色（休息日）**：周末（周六、周日）

### 查看时间段详情

点击任意工作日，下方将显示该日期的时间段详情：

- 显示所有时间段（09:00-18:00，每小时一个时间段）
- 每个时间段显示预约数量和状态
- 时间段状态标准：
  - **空闲**：≤ 1 单
  - **一般**：2-3 单
  - **繁忙**：≥ 4 单

### 月份切换

使用"上月"和"下月"按钮切换查看不同月份的预约情况。

## 5. 快捷操作

### 导出订单数据

将订单数据导出为 CSV 文件，方便在 Excel 中分析。

**操作步骤：**

1. 选择筛选条件（可选）：
   - 状态筛选：选择特定状态的订单
   - 开始日期：选择起始日期
   - 结束日期：选择结束日期
2. 点击"导出 CSV"按钮
3. 文件将自动下载到您的电脑

**导出字段：**

订单ID、客户电话、吉他类型、品牌、型号、问题描述、预约日期、预约时间、期望完成日期、状态、创建时间

### 批量更改状态

批量更改符合条件的订单状态。

**操作步骤：**

1. 选择当前状态：要更改的订单的当前状态
2. 选择新状态：要更改为的新状态
3. 可选：选择预约日期（只更改该日期的订单）
4. 点击"批量更新"按钮
5. 确认后系统将批量更新所有符合条件的订单

**使用场景：**

- 将某天所有"待确认"的订单批量改为"已确认"
- 将所有"维修中"的订单批量改为"已完成"

## 6. 安全建议

### 密码安全

- 使用强密码（至少 12 位，包含大小写字母、数字、特殊字符）
- 定期更换密码
- 不要与他人共享管理员账号

### 访问控制

- 仅在安全的网络环境下访问管理后台
- 使用完毕后及时退出登录
- 不要在公共电脑上保存登录信息

### 数据保护

- 定期导出订单数据进行备份
- 妥善保管导出的 CSV 文件
- 不要随意删除订单数据

## 7. 常见问题

### Q: 忘记管理员密码怎么办？

A: 在 Supabase Dashboard 中重置密码：
1. 进入 Authentication > Users
2. 找到管理员账号
3. 点击右侧的"..."菜单
4. 选择"Reset password"
5. 设置新密码

### Q: 可以创建多个管理员账号吗？

A: 可以。在 Supabase Dashboard 中按照相同步骤创建多个管理员账号。

### Q: 如何查看已删除的订单？

A: 已删除的订单无法恢复。建议在删除前先导出数据备份。

### Q: 客户可以自己取消订单吗？

A: 目前客户无法自己取消订单，需要联系管理员进行操作。

### Q: 如何修改营业时间？

A: 营业时间在代码中配置，需要修改 `js/repair-calendar.js` 文件中的 `BUSINESS_HOURS` 常量。

## 8. 技术支持

如遇到技术问题，请检查：

1. **浏览器控制台**：按 F12 打开开发者工具，查看是否有错误信息
2. **Supabase 日志**：在 Supabase Dashboard 中查看 API 日志
3. **网络连接**：确保网络连接正常

## 9. 系统维护

### 定期清理

建议定期清理已完成或已取消的旧订单：

```sql
-- 在 Supabase SQL Editor 中执行
-- 删除1年前已完成或已取消的订单
DELETE FROM guitar_repairs
WHERE status IN ('completed', 'cancelled')
AND updated_at < NOW() - INTERVAL '1 year';
```

### 数据统计

查看系统使用情况：

```sql
-- 按状态统计订单数量
SELECT status, COUNT(*) as count
FROM guitar_repairs
GROUP BY status;

-- 按吉他类型统计订单数量
SELECT guitar_type, COUNT(*) as count
FROM guitar_repairs
GROUP BY guitar_type
ORDER BY count DESC;

-- 查询最繁忙的时间段
SELECT
  appointment_time,
  COUNT(*) as booking_count
FROM guitar_repairs
WHERE appointment_date >= CURRENT_DATE
  AND status NOT IN ('cancelled')
GROUP BY appointment_time
ORDER BY booking_count DESC
LIMIT 5;
```

## 完成！

您现在已经了解如何使用管理员后台。如有任何问题，请参考本指南或联系技术支持。
